<%
let content = `
<div class="container-fluid py-4">
  <div class="row mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <div>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/campaigns">Campaigns</a></li>
            <li class="breadcrumb-item active">${campaign.name}</li>
          </ol>
        </nav>
        <h1><i class="bi bi-funnel-fill"></i> ${campaign.name}</h1>
        <p class="text-muted mb-0">
          Brand: <span class="badge bg-secondary">${campaign.brand_name}</span>
          ${campaign.target_url ? `
          | Target: <a href="${campaign.target_url}" target="_blank">${campaign.target_url}</a>` : ''}
        </p>
      </div>
      <div>
        <a href="/campaigns/${campaign.id}/edit" class="btn btn-outline-primary">
          <i class="bi bi-pencil"></i> Edit
        </a>
        <form method="POST" action="/campaigns/${campaign.id}/delete" class="d-inline"
          onsubmit="return confirm('Are you sure you want to delete this campaign? All associated leads will be deleted.');">
          <button class="btn btn-outline-danger">
            <i class="bi bi-trash"></i> Delete
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Stats -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card bg-primary text-white">
        <div class="card-body text-center">
          <h3>${stats.total_prospects}</h3>
          <small class="mb-0">Total Prospects</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-success text-white">
        <div class="card-body text-center">
          <h3>${stats.total_emails}</h3>
          <small class="mb-0">Emails Found</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-info text-white">
        <div class="card-body text-center">
          <h3>${stats.outreach_sent}</h3>
          <small class="mb-0">Outreach Sent</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-warning text-dark">
        <div class="card-body text-center">
          <h3>${stats.replied}</h3>
          <small class="mb-0">Replies</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Keywords -->
  ${campaign.keywords && campaign.keywords.length > 0 ? `
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <i class="bi bi-key"></i> Keywords
        </div>
        <div class="card-body">
${campaign.keywords.map(kw => `<span class="badge bg-light text-dark border me-2 mb-2">${kw}</span>`).join('')}
        </div>
      </div>
    </div>
  </div>` : ''}

  <!-- Assets -->
  ${assets && assets.length > 0 ? `
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <i class="bi bi-file-text"></i> Campaign Assets (${assets.length})
        </div>
        <div class="card-body">
          <div class="row">
${assets.map(asset => `
            <div class="col-md-6 mb-3">
              <div class="card">
                <div class="card-body">
                  <div class="d-flex justify-content-between">
                    <div>
                      <span class="badge bg-${asset.type === 'blog' ? 'success' : 'info'}">${asset.type}</span>
                      <strong class="ms-2">${asset.title || 'Untitled'}</strong>
                    </div>
                    <small>${new Date(asset.created_at).toLocaleDateString()}</small>
                  </div>
                  <a href="${asset.url}" target="_blank" class="text-truncate d-block mt-2">
                    ${asset.url}
                  </a>
                </div>
              </div>
            </div>`).join('')}
          </div>
        </div>
      </div>
    </div>
  </div>` : ''}

  <!-- Leads -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <i class="bi bi-link-45deg"></i> Leads (${leads.length})
        </div>
        <div class="card-body">
${leads.length > 0 ? `
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Domain</th>
                  <th>Company</th>
                  <th>Email</th>
                  <th>Status</th>
                  <th>Found</th>
                </tr>
              </thead>
              <tbody>
${leads.map(lead => {
                let statusColor = 'secondary';
                switch(lead.status) {
                  case 'NEW': statusColor = 'secondary'; break;
                  case 'READY': statusColor = 'info'; break;
                  case 'OUTREACH_SENT': statusColor = 'primary'; break;
                  case 'REPLIED': statusColor = 'success'; break;
                  case 'REJECTED': statusColor = 'danger'; break;
                }
                return `
                <tr>
                  <td><a href="/prospects/${lead.prospect_id}">${lead.domain}</a></td>
                  <td>${lead.company_name || '-'}</td>
                  <td>${lead.email ? `<a href="mailto:${lead.email}">${lead.email}</a>` : '-'}</td>
                  <td><span class="badge bg-${statusColor}">${lead.status}</span></td>
                  <td>${new Date(lead.found_at).toLocaleDateString()}</td>
                </tr>`;}).join('')}
              </tbody>
            </table>
          </div>` : `
          <p class="text-muted mb-0">No leads found for this campaign.</p>`}
        </div>
      </div>
    </div>
  </div>
</div>
`;
%>
<%- include('../layout', { title: campaign.name + ' - Outreach Admin', activePage: 'campaigns', content: content, user: user }) %>
