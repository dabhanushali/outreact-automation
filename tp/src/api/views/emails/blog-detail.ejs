<%
let content = `
<div class="container-fluid py-4">
  <div class="row mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <div>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/blog-emails">Blog Emails</a></li>
            <li class="breadcrumb-item"><a href="/blog-prospects/${email.blog_prospect_id}">${email.domain}</a></li>
            <li class="breadcrumb-item active">${email.email}</li>
          </ol>
        </nav>
        <h1><i class="bi bi-envelope"></i> ${email.email}</h1>
        <p class="text-muted mb-0"><a href="https://${email.domain}" target="_blank">${email.domain}</a> - ${email.blog_name || ''}</p>
      </div>
      <div>
        <div class="btn-group">
          <a href="/blog-emails/${email.id}/edit" class="btn btn-primary">
            <i class="bi bi-pencil"></i> Edit Email
          </a>
          <form method="POST" action="/blog-emails/${email.id}/delete" class="d-inline">
            <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this blog email?');">
              <i class="bi bi-trash"></i> Delete
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <i class="bi bi-info-circle"></i> Email Information
        </div>
        <div class="card-body">
          <table class="table table-sm">
            <tr><th>Email:</th><td><a href="mailto:${email.email}">${email.email}</a></td></tr>
            <tr><th>Domain:</th><td>${email.domain}</td></tr>
            <tr><th>Blog Name:</th><td>${email.blog_name || '-'}</td></tr>
            <tr><th>Domain Match:</th><td>${email.is_domain_match ? 'Yes' : 'No'}</td></tr>
            <tr><th>Generic:</th><td>${email.is_generic ? 'Yes' : 'No'}</td></tr>
            <tr><th>Confidence:</th><td>${email.confidence}%</td></tr>
            <tr><th>Source Page:</th><td>${email.source_page ? `<a href="${email.source_page}" target="_blank">View</a>` : '-'}</td></tr>
            <tr><th>Created:</th><td>${new Date(email.created_at).toLocaleString()}</td></tr>
          </table>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <i class="bi bi-link-45deg"></i> Campaign Associations
        </div>
        <div class="card-body">
${campaigns && campaigns.length > 0 ? `
          <div class="list-group">
${campaigns.map(camp => {
              let statusColor = 'secondary';
              switch(camp.status) {
                case 'NEW': statusColor = 'secondary'; break;
                case 'READY': statusColor = 'info'; break;
                case 'OUTREACH_SENT': statusColor = 'primary'; break;
                case 'REPLIED': statusColor = 'success'; break;
                case 'REJECTED': statusColor = 'danger'; break;
              }
              return `
            <div class="list-group-item">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <strong>${camp.campaign_name}</strong>
                  <br><small class="text-muted">${camp.brand_name}</small>
                </div>
                <span class="badge bg-${statusColor}">${camp.status}</span>
              </div>
            </div>`;}).join('')}
          </div>` : `
          <p class="text-muted mb-0">Not associated with any campaigns.</p>`}
        </div>
      </div>
    </div>
  </div>
</div>
`;
%>
<%- include('../layout', { title: email.email + ' - Blog Email - Outreach Admin', activePage: 'emails', content: content, user: user }) %>
