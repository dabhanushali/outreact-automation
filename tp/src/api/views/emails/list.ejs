<%
let content = `
<div class="container-fluid py-4">
  <div class="row mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <div>
        <h1><i class="bi bi-envelope"></i> Company Emails</h1>
        <p class="text-muted">Manage extracted company emails</p>
      </div>
      <div class="btn-group">
        <a href="/emails/new" class="btn btn-primary">
          <i class="bi bi-plus-lg"></i> Add Email
        </a>
        <a href="/emails/export${filters.campaign ? '?campaign=' + filters.campaign : ''}${filters.domain_match ? (filters.campaign ? '&' : '?') + 'domain_match=' + filters.domain_match : ''}${filters.generic ? (filters.campaign || filters.domain_match ? '&' : '?') + 'generic=' + filters.generic : ''}${filters.search ? (filters.campaign || filters.domain_match || filters.generic ? '&' : '?') + 'search=' + encodeURIComponent(filters.search) : ''}" class="btn btn-success">
          <i class="bi bi-file-earmark-spreadsheet"></i> Export Emails
        </a>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <form method="GET" action="/emails" class="row g-3">
            <div class="col-md-3">
              <select name="campaign" class="form-select">
                <option value="">All Campaigns</option>
${campaigns.map(c => `
                <option value="${c.id}" ${filters.campaign == c.id ? 'selected' : ''}>${c.name}</option>`).join('')}
              </select>
            </div>
            <div class="col-md-3">
              <select name="domain_match" class="form-select">
                <option value="">All Domain Matches</option>
                <option value="true" ${filters.domain_match === 'true' ? 'selected' : ''}>Match</option>
                <option value="false" ${filters.domain_match === 'false' ? 'selected' : ''}>No Match</option>
              </select>
            </div>
            <div class="col-md-3">
              <select name="generic" class="form-select">
                <option value="">All Types</option>
                <option value="true" ${filters.generic === 'true' ? 'selected' : ''}>Generic</option>
                <option value="false" ${filters.generic === 'false' ? 'selected' : ''}>Specific</option>
              </select>
            </div>
            <div class="col-md-3">
              <input type="text" name="search" class="form-control" placeholder="Search email..." value="${filters.search || ''}">
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-primary">Apply Filters</button>
              <a href="/emails" class="btn btn-secondary">Clear</a>
              <a href="/blog-emails" class="btn btn-outline-info ms-2">View Blog Emails</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Emails Table -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover table-sm">
              <thead>
                <tr>
                  <th>Email</th>
                  <th>Domain</th>
                  <th>Company</th>
                  <th>Domain Match</th>
                  <th>Generic</th>
                  <th>Confidence</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
${emails.map(email => `
                <tr>
                  <td><a href="mailto:${email.email}">${email.email}</a></td>
                  <td><a href="/prospects/${email.prospect_id}">${email.domain}</a></td>
                  <td>${email.company_name || '-'}</td>
                  <td>
                    <span class="badge bg-${email.is_domain_match ? 'success' : 'secondary'}">
                      ${email.is_domain_match ? 'Yes' : 'No'}
                    </span>
                  </td>
                  <td>
                    <span class="badge bg-${email.is_generic ? 'warning text-dark' : 'info'}">
                      ${email.is_generic ? 'Yes' : 'No'}
                    </span>
                  </td>
                  <td>${email.confidence}%</td>
                  <td>
                    <div class="btn-group btn-group-sm">
                      <a href="/emails/${email.id}" class="btn btn-outline-primary" title="View">
                        <i class="bi bi-eye"></i>
                      </a>
                      <a href="/emails/${email.id}/edit" class="btn btn-outline-secondary" title="Edit">
                        <i class="bi bi-pencil"></i>
                      </a>
                      <form method="POST" action="/emails/${email.id}/delete" class="d-inline">
                        <button type="submit" class="btn btn-outline-danger" title="Delete" onclick="return confirm('Delete this email?');">
                          <i class="bi bi-trash"></i>
                        </button>
                      </form>
                    </div>
                  </td>
                </tr>`).join('')}

${emails.length === 0 ? `
                <tr>
                  <td colspan="7" class="text-center text-muted py-4">No emails found.</td>
                </tr>` : ''}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
`;
%>
<%- include('../layout', { title: 'Emails - Outreach Admin', activePage: 'emails', content: content, user: user }) %>
